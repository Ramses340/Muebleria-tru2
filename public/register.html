<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Registro</title>

    <!-- Bootstrap -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">

    <!-- Icons -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css">

    <!-- SweetAlert2 -->
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

    <style>
        /* === PALETA === */
        :root {
            --bg-dark: #0d1117;
            --card-blue: #162238;
            --border-blue: #1e3050;
            --blue-primary: #1f4ea3;
            --blue-hover: #275fcc;
            --light-gray: #d7d7d7;
            --text-white: #ffffff;
        }

        body {
            background-color: var(--bg-dark) !important;
            color: var(--text-white);
        }

        /* === TARJETA === */
        .reg-card {
            background: var(--card-blue);
            border: 1px solid var(--border-blue);
            border-radius: 12px;
            width: 400px;
            color: var(--text-white);
        }

        h3 {
            color: var(--text-white);
            font-weight: 600;
        }

        /* === INPUTS === */
        .form-control {
            background-color: #ffffff !important;
            color: #000 !important;
            border-radius: 8px;
            border: 1px solid var(--border-blue);
        }

        .form-control::placeholder {
            color: #6f6f6f !important;
        }

        /* === INPUT GROUP === */
        .input-group-text {
            background-color: #ffffff !important;
            border: 1px solid var(--border-blue);
            border-radius: 8px;
            cursor: pointer;
        }

        .eye-btn i {
            color: #000 !important;
        }

        /* === BOTÓN === */
        .btn-primary {
            background-color: var(--blue-primary);
            border: none;
            font-weight: 600;
            border-radius: 8px;
        }

        .btn-primary:hover {
            background-color: var(--blue-hover);
        }

        /* === LINK === */
        a {
            color: #69a8ff;
            text-decoration: none;
        }

        a:hover {
            text-decoration: underline;
        }

        /* === BARRA DE FUERZA === */
        #strengthBar {
            height: 6px;
            border-radius: 4px;
            margin-top: 6px;
            transition: width 0.3s ease, background 0.3s ease;
        }

        /* === OJO === */
        .eye-btn {
            cursor: pointer;
            transition: transform 0.2s ease, opacity 0.2s ease;
        }
        .eye-btn:hover {
            transform: scale(1.2);
            opacity: 0.7;
        }
    </style>
</head>

<body class="d-flex justify-content-center align-items-center" style="height:100vh;">

<div class="reg-card shadow p-4">
    <h3 class="text-center mb-3">Crear cuenta</h3>

    <form id="formRegistro" novalidate>
        <div class="mb-3">
            <label class="form-label">Nombre</label>
            <input type="text" id="nombre" class="form-control" placeholder="Tu nombre" required>
        </div>

        <div class="mb-3">
            <label class="form-label">Correo</label>
            <input type="email" id="email" class="form-control" placeholder="correo@example.com" required>
        </div>

        <div class="mb-3">
            <label class="form-label">Contraseña</label>
            <div class="input-group">
                <input type="password" id="password" class="form-control" placeholder="Mínimo 8 caracteres" required oninput="checkStrength()">
                <span class="input-group-text eye-btn" onclick="togglePasswordReg()">
                    <i class="bi bi-eye" id="iconPasswordReg"></i>
                </span>
            </div>
            <div id="strengthBar"></div>
        </div>

        <button type="submit" class="btn btn-primary w-100" id="btnRegistrar">
            Registrarme
        </button>
    </form>

    <p class="text-center mt-3">
        ¿Ya tienes cuenta?
        <a href="/login.html">Iniciar sesión</a>
    </p>
</div>

<script>
function togglePasswordReg() {
    const input = document.getElementById("password");
    const icon = document.getElementById("iconPasswordReg");

    if (input.type === "password") {
        input.type = "text";
        icon.classList.replace("bi-eye", "bi-eye-slash");
    } else {
        input.type = "password";
        icon.classList.replace("bi-eye-slash", "bi-eye");
    }
}

function checkStrength() {
    const pass = document.getElementById("password").value;
    const bar = document.getElementById("strengthBar");

    let strength = 0;
    if (pass.length >= 8) strength++;
    if (/[A-Z]/.test(pass)) strength++;
    if (/[0-9]/.test(pass)) strength++;
    if (/[^A-Za-z0-9]/.test(pass)) strength++;

    switch (strength) {
        case 0:
            bar.style.width = "0%";
            break;
        case 1:
            bar.style.width = "25%";
            bar.style.background = "red";
            break;
        case 2:
            bar.style.width = "50%";
            bar.style.background = "orange";
            break;
        case 3:
            bar.style.width = "75%";
            bar.style.background = "gold";
            break;
        case 4:
            bar.style.width = "100%";
            bar.style.background = "green";
            break;
    }
}

document.getElementById("formRegistro").addEventListener("submit", async (e) => {
    e.preventDefault();

    const nombre = document.getElementById("nombre").value.trim();
    const email = document.getElementById("email").value.trim();
    const password = document.getElementById("password").value.trim();
    const btn = document.getElementById("btnRegistrar");

    if (!nombre || !email || !password) {
        Swal.fire("Campos incompletos", "Llena todos los campos", "warning");
        return;
    }

    btn.disabled = true;
    btn.innerText = "Registrando...";

    try {
        const res = await fetch("/api/auth/register", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({ nombre, email, password })
        });

        const data = await res.json();

        if (res.status === 201) {
            Swal.fire({
                icon: "success",
                title: "Usuario registrado correctamente",
                text: "Tu cuenta fue creada con éxito",
                confirmButtonColor: "#0d6efd"
            }).then(() => {
                window.location.href = "/login.html";
            });
        } else {
            let errorMsg = data.message || "No se pudo registrar";
            if (data.errors && Array.isArray(data.errors)) {
                errorMsg = data.errors.map(e => e.msg).join(", ");
            }
            Swal.fire("Error", errorMsg, "error");
        }

    } catch (error) {
        Swal.fire("Error", "No hay conexión con el servidor", "error");
    }

    btn.disabled = false;
    btn.innerText = "Registrarme";
});
</script>

</body>
</html>
